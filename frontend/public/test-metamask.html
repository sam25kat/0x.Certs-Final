<!DOCTYPE html>
<html>
<head>
    <title>Test MetaMask Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>MetaMask Connection Test</h1>
    <button onclick="testConnection()">Test Connection</button>
    <div id="output"></div>

    <script>
        async function testConnection() {
            const output = document.getElementById('output');
            
            try {
                // Check if MetaMask is available
                if (typeof window.ethereum === 'undefined') {
                    output.innerHTML = '❌ MetaMask not detected';
                    return;
                }

                // Connect to MetaMask
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                
                // Get network info
                const network = await provider.getNetwork();
                const address = await signer.getAddress();
                const balance = await provider.getBalance(address);
                
                output.innerHTML = `
                    <h3>✅ MetaMask Connected</h3>
                    <p><strong>Network:</strong> ${network.name} (Chain ID: ${network.chainId})</p>
                    <p><strong>Address:</strong> ${address}</p>
                    <p><strong>Balance:</strong> ${ethers.utils.formatEther(balance)} ETH</p>
                    
                    <h3>Contract Test</h3>
                    <button onclick="testContract()">Test Contract Call</button>
                    <div id="contractResult"></div>
                `;
                
            } catch (error) {
                output.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        async function testContract() {
            const contractResult = document.getElementById('contractResult');
            
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                
                // Test contract connection
                const contractAddress = "0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6";
                const abi = [
                    "function eventNames(uint256) external view returns (string memory)",
                    "function bulkMintPoA(address[] memory recipients, uint256 eventId) external"
                ];
                
                const contract = new ethers.Contract(contractAddress, abi, signer);
                
                // Test reading from contract
                const eventName = await contract.eventNames(5467);
                contractResult.innerHTML = `
                    <p><strong>Contract Address:</strong> ${contractAddress}</p>
                    <p><strong>Event 5467 Name:</strong> "${eventName}"</p>
                `;
                
                // Test estimating gas for bulk mint
                const testRecipient = await signer.getAddress();
                const gasEstimate = await contract.bulkMintPoA.estimateGas([testRecipient], 5467);
                contractResult.innerHTML += `<p><strong>Gas Estimate:</strong> ${gasEstimate.toString()}</p>`;
                contractResult.innerHTML += `<p>✅ Contract is accessible and gas estimation works!</p>`;
                
            } catch (error) {
                contractResult.innerHTML = `❌ Contract Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>